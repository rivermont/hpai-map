<!DOCTYPE html>
<html lang="en_US">
<head>
    <meta charset="UTF-8">
    <title>Live Avian Flu Outbreak 2022 Map</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.0/dist/leaflet.css"/>
    <!--<link rel="stylesheet" href="https://use.fontawesome.com/releases/v6.1.1/css/all.css">-->
    <style>
    html, body {
        width: 100%;
        height: 100%;
        margin: 0;
        background: #fff;
    }
    #content {
        height: 100%;
        width: 30%;
        position: absolute;
        top: 0;
        left: 0;
    }
    #map {
        height: 100%;
        width: 70%;
        position: absolute;
        top: 0;
        right: 0;
    }
    h2, h3 {
        text-align: center;
    }
    #wrapper {
        padding: 0.5em;
    }
    #legend {
        width: 100%;
    }
    #creds {
        position: absolute;
        bottom: 0;
        margin-bottom: 0.5em;
    }
    </style>
    <script src="https://unpkg.com/leaflet@1.7.0/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet-ajax/2.1.0/leaflet.ajax.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.0/jquery.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chroma-js/1.3.4/chroma.min.js"></script>
</head>
<body>
    <div id="content">
        <div id="wrapper">
        <h2>Live Avian Flu (HPAI) 2022 Outbreak Map</h2>
        <h3 id="date"></h3>
            <p>background text goes here 
            <br>(<a href="https://www.npr.org/2022/04/06/1091061758/bird-flu-outbreak" target="_blank">NPR</a>)</p>
            
            <div id="legend">legend and controls here (green scale is captive bird populations, orange scale is wild bird reports)</div>
            
            <small id="creds">Basemap style &copy; CartoDB | Basemap data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap contributors</a> | County data: <a href="https://www.census.gov/geographies/mapping-files/time-series/geo/cartographic-boundary.html">U.S. Census Bureau, 2020</a> | Map by <a href="https://rivermont.xyz">Will Bennett</a>, source code available <a href="https://github.com/rivermont/hpai-map">on GitHub</a>.</small>
        </div>
    </div>
    <div id="map"></div>
    <script>
        // TODO: load settings from json generated by py script
        
        var lemap = L.map('map', {
            center: [38, -92],
            zoom: 5,
            maxZoom: 15,
            minZoom: 2,
            detectRetina: true
        });
        
        L.tileLayer('https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png').addTo(lemap);
        
        L.control.scale({position: 'bottomleft'}).addTo(lemap);
        
        
        // Process captive bird data
        var counties_captive = null;
        
        colorsc = chroma.scale('YlGn').colors(15);
        
        function colorc(reports) {
            return colorsc[reports+4];
            // TODO: update with actual classes
        }
        
        function stylec(feature) {
            return {
                fillColor: colorc(Number(feature.properties.num_report_cap)),
                fillOpacity: 0.4,
                weight: 2,
                opacity: 0.94,
                color: '#b4b4b4'
            };
        }
        
        counties_captive = L.geoJson.ajax("./hpai_counties_cap.geojson", {
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.description);
            },
            style: stylec
        }).addTo(lemap);
            
        
        // process wild bird data
        var counties_wild = null;
        
        colorsw = chroma.scale('Oranges').colors(95);
        
        function colorw(reports) {
            return colorsw[reports+15];
            // TODO: update with actual classes
        }
        
        function stylew(feature) {
            return {
                fillColor: colorw(Number(feature.properties.num_report_wild)),
                fillOpacity: 0.4,
                weight: 2,
                opacity: 0.94,
                color: '#b4b4b4'
            }
        }
        
        counties_captive = L.geoJson.ajax("./hpai_counties_wild.geojson", {
            onEachFeature: function (feature, layer) {
                layer.bindPopup(feature.properties.description);
            },
            style: stylew
        }).addTo(lemap);
        
        // TODO: update #date with date script was run, stored in one of the geojsons
    </script>
</body>
</html>
